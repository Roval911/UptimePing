

## Формат коммитов

Используем [Conventional Commits][1] формат:

```
<type>(<scope>): <subject>

<body>

<footer>
```

## Типы коммитов

### feat
Новая функциональность для пользователя (не для сборки скрипта или вспомогательного инструмента)

```
feat(auth): add user registration endpoint
feat(core): implement HTTP checker with timeout support
```

### fix
Исправление бага для пользователя (не для сборки скрипта или вспомогательного инструмента)

```
fix(auth): resolve JWT token validation issue
fix(core): fix HTTP checker timeout handling
```

### docs
Изменения только в документации

```
docs: update API documentation
docs(architecture): add service communication diagram
```

### style
Изменения, которые не влияют на смысл кода (пробелы, форматирование, отсутствующие точки с запятой и т.д.)

```
style(auth): format code with gofmt
```

### refactor
Рефакторинг кода продакшена, например, переименование переменной

```
refactor(config): simplify validation logic
refactor(core): extract HTTP client creation
```

### perf
Изменение кода, которое улучшает производительность

```
perf(core): optimize database queries with indexes
perf(gateway): add connection pooling for gRPC clients
```

### test
Добавление отсутствующих тестов или исправление существующих тестов

```
test(auth): add unit tests for JWT utils
test(core): add integration tests for HTTP checker
```

### build
Изменения, влияющие на систему сборки или внешние зависимости (примеры: gulp, broccoli, npm)

```
build: update Go version to 1.21
build(docker): optimize Dockerfile layers
```

### ci
Изменения в наших CI конфигурационных файлах и скриптах (примеры: GitLab CI, Circle, BrowserStack, SauceLabs)

```
ci: add integration tests to pipeline
ci(gitlab): update deployment scripts
```

### chore
Другие изменения, которые не изменяют исходный код или тесты

```
chore: update dependencies
chore: add .gitignore entries
```

## Scope (область)

Scope указывает, какая часть кодовой базы затронута:

- `auth` - Auth Service
- `config` - Config Service
- `core` - Core Service
- `scheduler` - Scheduler Service
- `notification` - Notification Service
- `forge` - Forge Service
- `gateway` - API Gateway
- `metrics` - Metrics Service
- `infra` - Инфраструктура (docker, k8s, ci/cd)
- `docs` - Документация

## Subject (тема)

- Используйте императив, настоящее время: "change" не "changed" или "changes"
- Не пишите с заглавной буквы первую букву
- Не ставьте точку в конце
- Максимум 50 символов

**Хорошо:**
```
feat(auth): add user registration
fix(core): resolve timeout issue
```

**Плохо:**
```
feat(auth): Added user registration feature
fix(core): Fixed timeout issue.
feat(auth): Add user registration endpoint with email validation and password hashing
```

## Body (тело)

- Объясняет **что** и **почему** vs. **как**
- Может включать мотивацию для изменения и сравнение с предыдущим поведением
- Каждая строка максимум 72 символа

Пример:
```
feat(core): implement HTTP checker

Add HTTP/HTTPS checker with support for:
- GET, POST, PUT, DELETE methods
- Custom headers and body
- Status code validation
- Response body validation
- Response time measurement

Closes #123
```

## Footer (подвал)

Footer должен содержать любую информацию о Breaking Changes и также является местом для ссылок на GitHub issues, которые этот коммит закрывает.

Примеры:
```
BREAKING CHANGE: API Gateway now requires authentication for all endpoints

Closes #123
Refs #456
```

## Примеры полных коммитов

### Простой коммит
```
feat(auth): add user registration endpoint
```

### Коммит с телом
```
feat(core): implement HTTP checker

Add HTTP/HTTPS checker with support for multiple HTTP methods,
custom headers, body validation, and response time measurement.
The checker uses configurable timeouts and retry logic.

Closes #45
```

### Breaking change
```
feat(gateway): change authentication header format

BREAKING CHANGE: Authentication header changed from "Token" to "Authorization: Bearer"
All clients must update their authentication implementation.

Migration guide: https://docs.example.com/migration/v2
```

### Исправление бага
```
fix(core): resolve HTTP checker timeout issue

The HTTP checker was not properly handling timeouts when the
server did not respond. Now it correctly returns timeout error
and logs the issue.

Fixes #78
```

## Правила для Pull/Merge Requests

1. **Один коммит = одна логическая единица работы**
   2. Не смешивайте несколько несвязанных изменений
   3. Если нужно исправить предыдущий коммит, используйте `git commit --amend` или `git rebase -i`

2. **Частые коммиты**
   2. Коммитьте после каждого логического этапа
   3. Не накапливайте изменения

3. **Перед коммитом**
   2. Код компилируется
   3. Тесты проходят
   4. Линтер не выдает ошибок
   5. Сообщение коммита соответствует формату

4. **Ветвление**
   2. Одна ветка = одна фича/багфикс
   3. Название ветки должно отражать суть изменений
   4. После мерджа удаляйте ветку

## Примеры названий веток

```
feature/auth-service-init
feature/core-http-checker
bugfix/jwt-validation-error
hotfix/critical-db-connection
refactor/config-validation
docs/api-documentation
```

## Инструменты

### Commitizen
Можно использовать [Commitizen][2] для интерактивного создания коммитов:

```bash
npm install -g commitizen cz-conventional-changelog
echo '{ "path": "cz-conventional-changelog" }' > ~/.czrc
```

### Git hooks
Можно добавить pre-commit hook для проверки формата:

```bash
# .git/hooks/commit-msg
#!/bin/sh
commit_regex='^(feat|fix|docs|style|refactor|perf|test|build|ci|chore)(\(.+\))?: .{1,50}'

if ! grep -qE "$commit_regex" "$1"; then
    echo "Invalid commit message format!"
    echo "Format: <type>(<scope>): <subject>"
    exit 1
fi
```

[1]:	https://www.conventionalcommits.org/
[2]:	https://github.com/commitizen/cz-cli