syntax = "proto3";

package uptimeping.incident.v1;

//import "google/api/annotations.proto";

option go_package = "gitlab.com/rodionov_v_al/UptimePingPlatform/gen/go/proto/api/incident/v1";

// IncidentService предоставляет методы для управления инцидентами
service IncidentService {
  // CreateIncident создает новый инцидент
  rpc CreateIncident(CreateIncidentRequest) returns (Incident) {}
  
  // UpdateIncident обновляет существующий инцидент
  rpc UpdateIncident(UpdateIncidentRequest) returns (Incident) {}
  
  // ResolveIncident закрывает инцидент
  rpc ResolveIncident(ResolveIncidentRequest) returns (ResolveIncidentResponse) {}
  
  // ListIncidents возвращает список инцидентов с фильтрацией
  rpc ListIncidents(ListIncidentsRequest) returns (ListIncidentsResponse) {}
  
  // GetIncident возвращает детали инцидента
  rpc GetIncident(GetIncidentRequest) returns (GetIncidentResponse) {}
}

// Incident представляет инцидент системы
message Incident {
  string id = 1;
  string check_id = 2;
  string tenant_id = 3;
  IncidentStatus status = 4;
  IncidentSeverity severity = 5;
  string first_seen = 6;
  string last_seen = 7;
  int32 count = 8;
  string error_message = 9;
  string error_hash = 10;
}

// IncidentStatus определяет статус инцидента
enum IncidentStatus {
  INCIDENT_STATUS_UNSPECIFIED = 0;
  INCIDENT_STATUS_OPEN = 1;
  INCIDENT_STATUS_ACKNOWLEDGED = 2;
  INCIDENT_STATUS_RESOLVED = 3;
}

// IncidentSeverity определяет серьезность инцидента
enum IncidentSeverity {
  INCIDENT_SEVERITY_UNSPECIFIED = 0;
  INCIDENT_SEVERITY_WARNING = 1;
  INCIDENT_SEVERITY_ERROR = 2;
  INCIDENT_SEVERITY_CRITICAL = 3;
}

// CreateIncidentRequest содержит данные для создания инцидента
message CreateIncidentRequest {
  string check_id = 1;
  string tenant_id = 2;
  IncidentSeverity severity = 3;
  string error_message = 4;
}

// UpdateIncidentRequest содержит данные для обновления инцидента
message UpdateIncidentRequest {
  string incident_id = 1;
  IncidentStatus status = 2;
  IncidentSeverity severity = 3;
}

// ResolveIncidentRequest содержит ID инцидента для закрытия
message ResolveIncidentRequest {
  string incident_id = 1;
}

// ResolveIncidentResponse подтверждает закрытие инцидента
message ResolveIncidentResponse {
  bool success = 1;
}

// ListIncidentsRequest содержит параметры фильтрации и пагинации
message ListIncidentsRequest {
  string tenant_id = 1;
  IncidentStatus status = 2;
  IncidentSeverity severity = 3;
  int32 page_size = 4;
  int32 page_token = 5;
}

// ListIncidentsResponse содержит список инцидентов
message ListIncidentsResponse {
  repeated Incident incidents = 1;
  int32 next_page_token = 2;
}

// GetIncidentRequest содержит ID инцидента
message GetIncidentRequest {
  string incident_id = 1;
}

// GetIncidentResponse содержит детали инцидента и его историю
message GetIncidentResponse {
  Incident incident = 1;
  repeated IncidentEvent events = 2;
}

// IncidentEvent представляет событие в жизненном цикле инцидента
message IncidentEvent {
  string id = 1;
  string incident_id = 2;
  string type = 3;
  string description = 4;
  string created_at = 5;
  string user_id = 6;
}