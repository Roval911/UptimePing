syntax = "proto3";

package uptimeping.cli.v1;

//import "google/api/annotations.proto";

option go_package = "gitlab.com/rodionov_v_al/UptimePingPlatform/proto/api/cli/v1";

// CLIService предоставляет методы для командной строки
service CLIService {
  // ExecuteCommand выполняет команду CLI
  rpc ExecuteCommand(ExecuteCommandRequest) returns (ExecuteCommandResponse) {}
  
  // GetCommandSchema возвращает схему команд CLI
  rpc GetCommandSchema(GetCommandSchemaRequest) returns (CommandSchema) {}
  
  // StreamCommandOutput потоково передает вывод команды
  rpc StreamCommandOutput(StreamCommandRequest) returns (stream StreamCommandResponse) {}
}

// ExecuteCommandRequest содержит данные для выполнения команды
message ExecuteCommandRequest {
  string command = 1;
  repeated string args = 2;
  map<string, string> flags = 3;
  string context = 4; // окружение (dev, staging, prod)
}

// ExecuteCommandResponse содержит результат выполнения команды
message ExecuteCommandResponse {
  int32 exit_code = 1;
  string output = 2;
  string error = 3;
  string executed_at = 4;
}

// GetCommandSchemaRequest пустое сообщение для запроса схемы
message GetCommandSchemaRequest {}

// CommandSchema содержит схему всех команд CLI
message CommandSchema {
  repeated Command commands = 1;
}

// Command представляет команду CLI
message Command {
  string name = 1;
  string description = 2;
  repeated Command subcommands = 3;
  repeated Flag flags = 4;
  bool has_args = 5;
}

// Flag представляет флаг команды
message Flag {
  string name = 1;
  string short_name = 2;
  string description = 3;
  string type = 4; // "string", "int", "bool"
  string default_value = 5;
  bool required = 6;
}

// StreamCommandRequest содержит данные для потокового выполнения
message StreamCommandRequest {
  string command = 1;
  repeated string args = 2;
  map<string, string> flags = 3;
}

// StreamCommandResponse содержит потоковый вывод команды
message StreamCommandResponse {
  string output = 1;
  string error = 2;
  bool finished = 3;
  int32 exit_code = 4;
}